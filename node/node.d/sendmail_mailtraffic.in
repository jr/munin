#!/bin/sh
#
# Plugin to monitor sendmail statistics.
#
# Usage: Place in /etc/lrrd/client.d/ (or link it there  using ln -s)
#
# Parameters understood:
#
# 	config   (required)
# 	autoconf (optional)
#
# $Log$
# Revision 1.4  2004/11/21 20:27:53  jimmyo
# Upped generic/sendmail_mailstats and generic/sendmail_mailtraffic to auto family.
#
# Revision 1.3  2004/05/20 19:02:36  jimmyo
# Set categories on a bunch of plugins
#
# Revision 1.2  2004/02/18 18:40:03  jimmyo
# Added Log:
#
# Magic markers (used by munin-node-configure)
#%# capabilities=autoconf
#%# family=auto

TEMP_FILE=/tmp/munin-sendmail.$$

if [ "$1" = "autoconf" ]; then
	if [ -f ${TEMP_FILE} ] ; then
		echo yes
		exit 0
	else
		echo no
		exit 1
	fi
fi

if [ "$1" = "config" ]; then

	echo 'graph_title Sendmail email volumes'
	echo 'graph_order received sent'
	echo 'graph_vlabel bytes'
	echo 'graph_category sendmail'
	echo 'received.label received'
	echo 'sent.label sent'
	exit 0
fi

received=0 ; sent=0
grep '^ *T' ${TEMP_FILE} | \
(
while read line ; do
  set -- ${line}
  received=`expr ${received} + $5`
  sent=`expr ${sent} + $3`
done
rm -f ${TEMP_FILE}

echo "received.value ${received}"
echo "sent.value ${sent}"
)
