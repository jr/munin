#!/bin/sh
#
# NOTE: This plugins is outdated. Use the sensors_ wildcard plugin instead.
#
#%# family=contrib

STATEFILE="@@PLUGSTATE@@/plugin-i2c_temp.state"

if [ "$1" = "config" ]; then
        echo 'graph_title Fan speed'
	echo 'graph_vtitle RPM'
	echo 'graph_order fan1=i2c:fan'
	echo 'graph_args -l 0'
	echo 'fan1.label fan1'
	echo 'fan1.graph no'
        exit 0
fi

if [ -f "$STATEFILE" ]; then
	if [ $(($(date +"%s")-$(stat -c "%Z" $STATEFILE))) -gt 60 ]; then
	    sensors $chips | tee $STATEFILE | awk '/fan/ {++i; print $1 ".value", $2+0}'
	else
	    cat $STATEFILE |awk '/fan/ {++i; print $1 ".value", $2+0}'
	fi
else
	sensors $chips | tee $STATEFILE | awk '/fan/ {++i; print $1 ".value", $2+0}'
fi


